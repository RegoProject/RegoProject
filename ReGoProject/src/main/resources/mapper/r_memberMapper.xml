<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.smhrd.mapper.r_memberMapper">

<select id="myIngredients" resultType="com.smhrd.entity.r_ingre_join_data" parameterType="com.smhrd.entity.r_ingre_join_data">
		/* select.myIngredients */
		<![CDATA[
					SELECT RI.ingreName
						 , RMI.ingreAmount
						 , RI.ingreImg
					  FROM r_my_ingredients RMI
					  JOIN r_ingredients RI ON RMI.ingreIdx = RI.ingreIdx
					 WHERE RMI.custId = #{custId}
		]]>
</select>

<!-- 사용자가 재료 보유했는지 검색기능 -->
<select id="searchMyIngre" resultType="com.smhrd.entity.r_ingre_join_data" parameterType="com.smhrd.entity.r_ingre_join_data">
		/* select.searchMyIngre */
		<![CDATA[
					SELECT RI.ingreName
						 , RMI.ingreAmount
					  FROM r_my_ingredients RMI
					  JOIN r_ingredients RI ON RMI.ingreIdx = RI.ingreIdx
					 WHERE RMI.custId = #{custId}
					   AND LOWER(RI.ingreName) LIKE CONCAT('%', #{ingreName}, '%')
		]]>
</select>

<select id="myMsg" resultType="com.smhrd.entity.r_msg_join_data" parameterType="com.smhrd.entity.r_msg_join_data">
		/* select.myMsg */
		<![CDATA[
					SELECT RM.msgName
						 , RMM.msgAmount
						 , RM.msgImg
					  FROM r_my_msg RMM
					  JOIN r_msg RM ON RMM.msgIdx = RM.msgIdx
					 WHERE RMM.custId = #{custId}
		]]>
</select>


<!-- addMsg용 select 사전이행 쿼리문 -->
<select id="selectMyMsg" resultType="com.smhrd.entity.r_my_msg" parameterType="com.smhrd.entity.r_my_msg">
		/* seelct.selectMyMsg */
		<![CDATA[
				SELECT *
				  FROM r_my_msg 
				  WHERE custId = #{custId}
				    AND msgIdx = #{msgIdx}
		]]>

</select>


<!-- 유저 r_my_msg 테이블에 조미료 정보가 없을경우 insert -->
<insert id="insertMyMsg" parameterType="com.smhrd.entity.r_my_msg">
	/* insert.insertMyMsg */
    <![CDATA[
				INSERT INTO 	r_my_msg (
											custId
											, msgIdx
											, msgAmount
										 )
				VALUES					(	#{custId}
											, #{msgIdx} 
											, 1
										 )
    ]]>
</insert>


<!-- 유저 r_my_msg 테이블에 조미료 정보가 있을경우 update -->
<update id="updateMyMsg" parameterType="com.smhrd.entity.r_my_msg">
    <![CDATA[
			    UPDATE r_my_msg
			       SET msgAmount = #{msgAmount}
			     WHERE custId = #{custId}
			       AND msgIdx = #{msgIdx} 
    ]]>
</update>

</mapper>